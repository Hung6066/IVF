<div class="lab-dashboard page-container">
    <header class="page-header">
        <h1>üß´ Ph√≤ng Lab - LABO</h1>
        <div class="tabs-container">
            <button class="tab-btn" [class.active]="activeTab === 'queue'" (click)="setActiveTab('queue')">
                üé´ H√†ng ƒë·ª£i
            </button>
            <button class="tab-btn" [class.active]="activeTab === 'embryos'" (click)="setActiveTab('embryos')">
                üî¨ Ph√¥i ƒëang nu√¥i
            </button>
            <button class="tab-btn" [class.active]="activeTab === 'schedule'" (click)="setActiveTab('schedule')">
                üìÖ L·ªãch th·ªß thu·∫≠t
            </button>
            <button class="tab-btn" [class.active]="activeTab === 'cryo'" (click)="setActiveTab('cryo')">
                ‚ùÑÔ∏è Kho ƒë√¥ng l·∫°nh
            </button>
            <button class="tab-btn" [class.active]="activeTab === 'report'" (click)="setActiveTab('report')">
                üìä B√°o c√°o ph√¥i
            </button>
            <button class="tab-btn" [class.active]="activeTab === 'forms'" (click)="setActiveTab('forms')">
                üìã Bi·ªÉu m·∫´u
            </button>
        </div>
    </header>

    <div class="date-nav">
        <button (click)="changeDay(-1)">‚óÄ</button>
        <span class="current-date">{{ currentDate | date:'EEEE, dd/MM/yyyy' }}</span>
        <button (click)="changeDay(1)">‚ñ∂</button>
        <button class="btn-today" (click)="goToday()">H√¥m nay</button>
    </div>

    <div class="stats-row">
        <div class="stat-card">
            <span class="icon">ü•ö</span>
            <div>
                <span class="value">{{ stats().eggRetrievalCount }}</span>
                <span class="label">Ch·ªçc h√∫t</span>
            </div>
        </div>
        <div class="stat-card">
            <span class="icon">üî¨</span>
            <div>
                <span class="value">{{ stats().cultureCount }}</span>
                <span class="label">ƒêang nu√¥i</span>
            </div>
        </div>
        <div class="stat-card">
            <span class="icon">üíâ</span>
            <div>
                <span class="value">{{ stats().transferCount }}</span>
                <span class="label">Chuy·ªÉn ph√¥i</span>
            </div>
        </div>
        <div class="stat-card">
            <span class="icon">‚ùÑÔ∏è</span>
            <div>
                <span class="value">{{ stats().freezeCount }}</span>
                <span class="label">Tr·ªØ ph√¥i</span>
            </div>
        </div>
    </div>

    @if (activeTab === 'queue') {
    <app-lab-queue [queue]="queue()" (callPatient)="onCallPatient($event)" (startProcedure)="onStartProcedure($event)"
        (skipPatient)="onSkipPatient($event)">
    </app-lab-queue>
    }

    @if (activeTab === 'embryos') {
    <app-lab-embryos [embryos]="embryos()" [activeCycles]="activeCycles()" [cryoLocations]="cryoLocations()"
        [currentDate]="currentDate" (selectEmbryo)="onSelectEmbryo($event)" (saveEmbryo)="onSaveEmbryo($event)"
        (deleteEmbryo)="onDeleteEmbryo($event)">
    </app-lab-embryos>
    }

    @if (activeTab === 'schedule') {
    <app-lab-schedule [schedule]="schedule()" [activeCycles]="activeCycles()" [doctors]="doctors()"
        [currentDate]="currentDate" (toggleStatus)="onToggleSchedule($event)" (addSchedule)="onAddSchedule($event)">
    </app-lab-schedule>
    }

    @if (activeTab === 'cryo') {
    <app-lab-cryo [locations]="cryoLocations()" [stats]="stats()" (addLocation)="onAddCryoLocation($event)"
        (updateLocation)="onUpdateCryoLocation($event)" (deleteLocation)="onDeleteCryoLocation($event)">
    </app-lab-cryo>
    }

    @if (activeTab === 'report') {
    <section class="content-section card">
        <div class="section-header">
            <h2>B√°o c√°o ph√¥i theo ng√†y</h2>
            <div class="report-actions">
                <button class="btn btn-secondary" (click)="exportExcel()">üìÑ Xu·∫•t Excel</button>
                <button class="btn btn-secondary" (click)="printReport()">üñ®Ô∏è In b√°o c√°o</button>
            </div>
        </div>
        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>M√£ CK</th>
                        <th>B·ªánh nh√¢n</th>
                        <th>Ng√†y ch·ªçc</th>
                        <th>S·ªë tr·ª©ng</th>
                        <th>MII</th>
                        <th>2PN</th>
                        <th>D3</th>
                        <th>D5/D6</th>
                        <th>Chuy·ªÉn</th>
                        <th>Tr·ªØ</th>
                        <th>K·∫øt qu·∫£</th>
                    </tr>
                </thead>
                <tbody>
                    @for (row of embryoReport(); track row.cycleCode) {
                    <tr>
                        <td class="code">{{ row.cycleCode }}</td>
                        <td>{{ row.patientName }}</td>
                        <td>{{ row.aspirationDate }}</td>
                        <td>{{ row.totalEggs }}</td>
                        <td>{{ row.mII }}</td>
                        <td>{{ row.twoPN }}</td>
                        <td>{{ row.d3 }}</td>
                        <td>{{ row.d5D6 }}</td>
                        <td>{{ row.transferred > 0 ? row.transferred : '‚Äî' }}</td>
                        <td>{{ row.frozen > 0 ? row.frozen : '‚Äî' }}</td>
                        <td>
                            <span class="badge" [class.badge-success]="row.status === 'Ho√†n th√†nh'"
                                [class.badge-info]="row.status !== 'Ho√†n th√†nh'">
                                {{ row.status }}
                            </span>
                        </td>
                    </tr>
                    } @empty {
                    <tr>
                        <td colspan="11" class="text-center text-muted">Kh√¥ng c√≥ d·ªØ li·ªáu</td>
                    </tr>
                    }
                </tbody>
            </table>
        </div>
    </section>
    }

    @if (activeTab === 'forms') {
    <app-quick-forms-widget
    title="Bi·ªÉu m·∫´u Lab"
    [maxForms]="12">
    </app-quick-forms-widget>
    }
</div>
