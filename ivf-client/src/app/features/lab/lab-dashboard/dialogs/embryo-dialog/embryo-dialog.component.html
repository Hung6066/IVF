<div class="modal-overlay" (click)="close()">
    <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h2>{{ isEdit ? '‚úèÔ∏è C·∫≠p nh·∫≠t ph√¥i' : '‚ûï Th√™m ph√¥i m·ªõi' }}</h2>
            <button class="close-btn" (click)="close()">√ó</button>
        </div>
        <form (ngSubmit)="onSubmit()">
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Ch·ªçn h·ªì s∆° (Cycle) *</label>
                    <select [(ngModel)]="embryo.cycleId" name="cycleId" required class="form-control"
                        [disabled]="isEdit" (change)="onCycleChange()">
                        <option value="" disabled>-- Ch·ªçn h·ªì s∆° --</option>
                        @for (cycle of activeCycles; track cycle.id) {
                        <option [value]="cycle.id">
                            {{ cycle.cycleCode }} - {{ cycle.wifeName }}
                        </option>
                        }
                    </select>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Ng√†y th·ª• tinh *</label>
                        <input type="date" [(ngModel)]="embryo.fertilizationDate" name="fertilizationDate" required
                            class="form-control" />
                    </div>
                    <div class="form-group">
                        <label class="form-label">S·ªë ph√¥i *</label>
                        <input type="number" [(ngModel)]="embryo.embryoNumber" name="number" required min="1"
                            class="form-control" />
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ng√†y nu√¥i (Day)</label>
                        <select [(ngModel)]="embryo.day" name="day" class="form-control">
                            <option value="D3">Ng√†y 3</option>
                            <option value="D5">Ng√†y 5</option>
                            <option value="D6">Ng√†y 6</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Ch·∫•t l∆∞·ª£ng (Grade) *</label>
                    <input type="text" [(ngModel)]="embryo.grade" name="grade" required placeholder="VD: 4AA, 3AB..."
                        class="form-control" />
                </div>

                <div class="form-group">
                    <label class="form-label">Tr·∫°ng th√°i</label>
                    <select [(ngModel)]="embryo.status" name="status" class="form-control">
                        <option value="Developing">ƒêang nu√¥i (Developing)</option>
                        <option value="Frozen">ƒê√¥ng l·∫°nh (Frozen)</option>
                        <option value="Transferred">ƒê√£ chuy·ªÉn (Transferred)</option>
                        <option value="Discarded">Lo·∫°i b·ªè (Discarded)</option>
                    </select>
                </div>

                @if (embryo.status === 'Frozen') {
                <div class="form-group">
                    <label class="form-label">V·ªã tr√≠ l∆∞u tr·ªØ</label>
                    <select [(ngModel)]="embryo.location" name="location" class="form-control">
                        <option value="" disabled>-- Ch·ªçn v·ªã tr√≠ --</option>
                        @for (loc of cryoLocations; track loc.tank) {
                        <option [value]="loc.tank">
                            {{ loc.tank }} (C√≤n: {{ loc.available }})
                        </option>
                        }
                    </select>
                </div>
                }
            </div>
            <div class="modal-footer">
                @if (isEdit) {
                <button type="button" class="btn btn-danger" (click)="onDelete()">üóëÔ∏è X√≥a ph√¥i</button>
                }
                <button type="button" class="btn btn-secondary" (click)="close()">Hu·ª∑</button>
                <button type="submit" class="btn btn-primary">L∆∞u th√¥ng tin</button>
            </div>
        </form>
    </div>
</div>