<div class="dashboard-layout">
    <header class="page-header">
        <div class="header-title">
            <h1>üè¶ Ng√¢n h√†ng tinh tr√πng</h1>
        </div>
        <div class="tabs-container">
            <button class="tab-btn" [class.active]="activeTab === 'donors'" (click)="activeTab = 'donors'">üë§ Ng∆∞·ªùi
                hi·∫øn</button>
            <button class="tab-btn" [class.active]="activeTab === 'samples'" (click)="activeTab = 'samples'">üß™ M·∫´u l∆∞u
                tr·ªØ</button>
            <button class="tab-btn" [class.active]="activeTab === 'matching'" (click)="activeTab = 'matching'">üîó Gh√©p
                ƒë√¥i</button>
        </div>
    </header>

    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon info">üë•</div>
            <div class="stat-content">
                <span class="value">{{ totalDonors() }}</span>
                <span class="label">Ng∆∞·ªùi hi·∫øn</span>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon primary">üßä</div>
            <div class="stat-content">
                <span class="value">{{ totalSamples() }}</span>
                <span class="label">M·∫´u ƒë√¥ng l·∫°nh</span>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon success">‚úÖ</div>
            <div class="stat-content">
                <span class="value">{{ availableSamples() }}</span>
                <span class="label">S·∫µn s√†ng</span>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon warning">‚è≥</div>
            <div class="stat-content">
                <span class="value">{{ quarantineSamples() }}</span>
                <span class="label">C√°ch ly</span>
            </div>
        </div>
    </div>

    @if (activeTab === 'donors') {
    <section class="card">
        <div class="section-header">
            <h2>Ng∆∞·ªùi hi·∫øn tinh tr√πng</h2>
            <button class="btn btn-primary" (click)="showNewDonor = true">‚ûï ƒêƒÉng k√Ω m·ªõi</button>
        </div>
        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>M√£</th>
                        <th>Nh√≥m m√°u</th>
                        <th>Tu·ªïi</th>
                        <th>S·ªë m·∫´u</th>
                        <th>Tr·∫°ng th√°i</th>
                        <th class="text-right">Thao t√°c</th>
                    </tr>
                </thead>
                <tbody>
                    @for (d of donors(); track d.id) {
                    <tr>
                        <td class="code-cell">{{ d.code }}</td>
                        <td>{{ d.bloodType }}</td>
                        <td>{{ d.age }}</td>
                        <td>{{ d.samples }}</td>
                        <td><span class="status-badge" [class]="d.status">{{ d.status }}</span></td>
                        <td class="actions-cell">
                            <button class="btn-icon" (click)="viewDonor(d)">üìã</button>
                            <button class="btn-icon" (click)="editDonor(d)">‚úèÔ∏è</button>
                        </td>
                    </tr>
                    } @empty {
                    <tr>
                        <td colspan="6" class="empty-state">Kh√¥ng c√≥ d·ªØ li·ªáu</td>
                    </tr>
                    }
                </tbody>
            </table>
        </div>
    </section>
    }

    @if (activeTab === 'samples') {
    <section class="card">
        <div class="section-header">
            <h2>Kho m·∫´u</h2>
            <button class="btn btn-primary" (click)="showNewSample = true">‚ûï Th√™m m·∫´u</button>
        </div>
        <div class="sample-grid">
            @for (s of samples(); track s.id) {
            <div class="sample-card" [class]="s.status">
                <div class="header">
                    {{ s.code }}
                    <div class="actions">
                        <button class="btn-sm" (click)="editSample(s)">‚úèÔ∏è</button>
                        <button class="btn-sm" (click)="deleteSample(s)">üóëÔ∏è</button>
                    </div>
                </div>
                <div class="info">
                    {{ s.donor }} ‚Ä¢ {{ s.vials }} vial
                </div>
            </div>
            } @empty {
            <div class="empty-state">Kh√¥ng c√≥ m·∫´u</div>
            }
        </div>
    </section>
    }

    @if (activeTab === 'matching') {
    <section class="card">
        <div class="section-header">
            <h2>Gh√©p ƒë√¥i</h2>
            <button class="btn btn-primary" (click)="showNewMatch = true">‚ûï Gh√©p ƒë√¥i m·ªõi</button>
        </div>
        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Ng∆∞·ªùi nh·∫≠n</th>
                        <th>Ng∆∞·ªùi hi·∫øn</th>
                        <th>Ng√†y</th>
                        <th>Tr·∫°ng th√°i</th>
                        <th class="text-right">Thao t√°c</th>
                    </tr>
                </thead>
                <tbody>
                    @for (m of matches(); track m.id) {
                    <tr>
                        <td>{{ m.recipient }}</td>
                        <td class="code-cell">{{ m.donor }}</td>
                        <td>{{ m.date }}</td>
                        <td><span class="status-badge">{{ m.status }}</span></td>
                        <td class="actions-cell">
                            <button class="btn-icon" (click)="viewMatch(m)">üëÅÔ∏è</button>
                            <button class="btn-icon" (click)="editMatch(m)">‚úèÔ∏è</button>
                        </td>
                    </tr>
                    } @empty {
                    <tr>
                        <td colspan="5" class="empty-state">Kh√¥ng c√≥</td>
                    </tr>
                    }
                </tbody>
            </table>
        </div>
    </section>
    }

    @if (showNewDonor) {
    <div class="modal-overlay" (click)="showNewDonor = false">
        <div class="modal-content" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <h2>‚ûï ƒêƒÉng k√Ω ng∆∞·ªùi hi·∫øn m·ªõi</h2>
                <button class="close-btn" (click)="showNewDonor = false">√ó</button>
            </div>
            <form (ngSubmit)="submitDonor()">
                <div class="modal-body">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Nh√≥m m√°u *</label>
                            <select class="form-control" [(ngModel)]="newDonor.bloodType" name="blood" required>
                                <option value="">Ch·ªçn...</option>
                                <option value="A+">A+</option>
                                <option value="A-">A-</option>
                                <option value="B+">B+</option>
                                <option value="B-">B-</option>
                                <option value="O+">O+</option>
                                <option value="O-">O-</option>
                                <option value="AB+">AB+</option>
                                <option value="AB-">AB-</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Tu·ªïi *</label>
                            <input class="form-control" type="number" [(ngModel)]="newDonor.age" name="age" required
                                min="18" max="45" />
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Chi·ªÅu cao (cm)</label>
                            <input class="form-control" type="number" [(ngModel)]="newDonor.height" name="height" />
                        </div>
                        <div class="form-group">
                            <label class="form-label">Tr√¨nh ƒë·ªô h·ªçc v·∫•n</label>
                            <input class="form-control" type="text" [(ngModel)]="newDonor.education" name="edu" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ghi ch√∫</label>
                        <textarea class="form-control" [(ngModel)]="newDonor.notes" name="notes"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" (click)="showNewDonor = false">Hu·ª∑</button>
                    <button type="submit" class="btn btn-primary">ƒêƒÉng k√Ω</button>
                </div>
            </form>
        </div>
    </div>
    }

    @if (showNewSample) {
    <div class="modal-overlay" (click)="showNewSample = false">
        <div class="modal-content" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <h2>‚ûï Th√™m m·∫´u l∆∞u tr·ªØ</h2>
                <button class="close-btn" (click)="showNewSample = false">√ó</button>
            </div>
            <form (ngSubmit)="submitSample()">
                <div class="modal-body">
                    <div class="form-group">
                        <label class="form-label">M√£ ng∆∞·ªùi hi·∫øn *</label>
                        <select class="form-control" [(ngModel)]="newSample.donor" name="donor" required>
                            @for (d of donors(); track d.id) {
                            <option [value]="d.code">{{ d.code }} - {{ d.bloodType }}</option>
                            }
                        </select>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">S·ªë l·ªã (vials) *</label>
                            <input class="form-control" type="number" [(ngModel)]="newSample.vials" name="vials"
                                required min="1" />
                        </div>
                        <div class="form-group">
                            <label class="form-label">Tr·∫°ng th√°i</label>
                            <select class="form-control" [(ngModel)]="newSample.status" name="status">
                                <option value="Quarantine">C√°ch ly</option>
                                <option value="Available">S·∫µn s√†ng</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">V·ªã tr√≠ l∆∞u tr·ªØ</label>
                        <input class="form-control" type="text" [(ngModel)]="newSample.location" name="loc"
                            placeholder="B√¨nh - Canister - V·ªã tr√≠" />
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" (click)="showNewSample = false">Hu·ª∑</button>
                    <button type="submit" class="btn btn-primary">L∆∞u m·∫´u</button>
                </div>
            </form>
        </div>
    </div>
    }

    @if (showNewMatch) {
    <div class="modal-overlay" (click)="showNewMatch = false">
        <div class="modal-content" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <h2>‚ûï Gh√©p ƒë√¥i m·ªõi</h2>
                <button class="close-btn" (click)="showNewMatch = false">√ó</button>
            </div>
            <form (ngSubmit)="submitMatch()">
                <div class="modal-body">
                    <div class="form-group">
                        <label class="form-label">Ng∆∞·ªùi nh·∫≠n (b·ªánh nh√¢n) *</label>
                        <input class="form-control" type="text" [(ngModel)]="newMatch.recipient" name="recipient"
                            placeholder="T√™n ho·∫∑c m√£ BN..." required />
                    </div>
                    <div class="form-group">
                        <label class="form-label">M√£ ng∆∞·ªùi hi·∫øn *</label>
                        <select class="form-control" [(ngModel)]="newMatch.donor" name="donor" required>
                            @for (d of donors(); track d.id) {
                            <option [value]="d.code">{{ d.code }} - {{ d.bloodType }}</option>
                            }
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ghi ch√∫</label>
                        <textarea class="form-control" [(ngModel)]="newMatch.notes" name="notes"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" (click)="showNewMatch = false">Hu·ª∑</button>
                    <button type="submit" class="btn btn-primary">X√°c nh·∫≠n gh√©p</button>
                </div>
            </form>
        </div>
    </div>
    }
</div>