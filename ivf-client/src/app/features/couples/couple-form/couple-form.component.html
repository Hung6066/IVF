<div class="couple-form">
    <header class="page-header">
        <a routerLink="/couples" class="back-link">
            <span>‚Üê</span> Danh s√°ch c·∫∑p ƒë√¥i
        </a>
        <h1>T·∫°o c·∫∑p ƒë√¥i m·ªõi</h1>
    </header>

    <form (ngSubmit)="submit()" class="card form-card">
        <div class="partner-section">
            <h2 class="section-title">üë© Th√¥ng tin v·ª£</h2>

            <div class="search-box">
                <div class="input-wrapper">
                    <input type="text" class="form-control" [(ngModel)]="wifeSearch" name="wifeSearch"
                        placeholder="T√¨m b·ªánh nh√¢n n·ªØ (m√£ BN ho·∫∑c t√™n)..." (input)="searchWife()"
                        [disabled]="!!selectedWife()" />
                    @if (!selectedWife()) {
                    <span class="search-icon">üîç</span>
                    }
                </div>

                @if (wifeResults().length > 0) {
                <div class="search-results">
                    @for (p of wifeResults(); track p.id) {
                    <div class="result-item" (click)="selectWife(p)">
                        <span class="code">{{ p.patientCode }}</span>
                        <span class="name">{{ p.fullName }}</span>
                    </div>
                    }
                </div>
                }
            </div>

            @if (selectedWife()) {
            <div class="selected-patient wife">
                <div class="avatar">üë©</div>
                <div class="info">
                    <strong>{{ selectedWife()?.fullName }}</strong>
                    <span class="code">{{ selectedWife()?.patientCode }}</span>
                </div>
                <button type="button" class="btn-icon-clear" (click)="clearWife()" title="X√≥a">‚úï</button>
            </div>
            }
        </div>

        <div class="partner-section">
            <h2 class="section-title">üë® Th√¥ng tin ch·ªìng</h2>

            <div class="search-box">
                <div class="input-wrapper">
                    <input type="text" class="form-control" [(ngModel)]="husbandSearch" name="husbandSearch"
                        placeholder="T√¨m b·ªánh nh√¢n nam (m√£ BN ho·∫∑c t√™n)..." (input)="searchHusband()"
                        [disabled]="!!selectedHusband()" />
                    @if (!selectedHusband()) {
                    <span class="search-icon">üîç</span>
                    }
                </div>

                @if (husbandResults().length > 0) {
                <div class="search-results">
                    @for (p of husbandResults(); track p.id) {
                    <div class="result-item" (click)="selectHusband(p)">
                        <span class="code">{{ p.patientCode }}</span>
                        <span class="name">{{ p.fullName }}</span>
                    </div>
                    }
                </div>
                }
            </div>

            @if (selectedHusband()) {
            <div class="selected-patient husband">
                <div class="avatar">üë®</div>
                <div class="info">
                    <strong>{{ selectedHusband()?.fullName }}</strong>
                    <span class="code">{{ selectedHusband()?.patientCode }}</span>
                </div>
                <button type="button" class="btn-icon-clear" (click)="clearHusband()" title="X√≥a">‚úï</button>
            </div>
            }
        </div>

        <div class="details-section">
            <h2 class="section-title">üíç Th√¥ng tin h√¥n nh√¢n</h2>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Ng√†y k·∫øt h√¥n</label>
                    <input type="date" class="form-control" [(ngModel)]="formData.marriageDate" name="marriageDate" />
                </div>
                <div class="form-group">
                    <label class="form-label">S·ªë nƒÉm hi·∫øm mu·ªôn</label>
                    <div class="input-suffix-group">
                        <input type="number" class="form-control" [(ngModel)]="formData.infertilityYears"
                            name="infertilityYears" min="0" />
                        <span class="suffix">nƒÉm</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="form-actions">
            <button type="button" class="btn btn-secondary" routerLink="/couples">Hu·ª∑</button>
            <button type="submit" class="btn btn-primary" [disabled]="saving() || !canSubmit()">
                {{ saving() ? 'ƒêang l∆∞u...' : 'T·∫°o c·∫∑p ƒë√¥i' }}
            </button>
        </div>
    </form>
</div>