<div class="security-page">
  <div class="page-header">
    <div class="header-left">
      <h2>ğŸ›¡ï¸ GiÃ¡m sÃ¡t báº£o máº­t</h2>
      <p class="subtitle">Zero Trust Security Monitor â€” GiÃ¡m sÃ¡t theo thá»i gian thá»±c</p>
    </div>
    <div class="header-actions">
      <label class="auto-refresh-toggle">
        <input type="checkbox" [checked]="autoRefresh()" (change)="toggleAutoRefresh()" />
        <span>Tá»± Ä‘á»™ng lÃ m má»›i (30s)</span>
      </label>
      <button class="btn btn-sm btn-outline" (click)="loadDashboard()" [disabled]="loading()">
        ğŸ”„ LÃ m má»›i
      </button>
    </div>
  </div>

  <!-- Summary Stats -->
  <div class="stats-grid">
    <div class="stat-card stat-red" (click)="navigateTo('/admin/security-events')">
      <div class="stat-icon">ğŸš¨</div>
      <div class="stat-info">
        <span class="stat-value">{{ totalHighSeverity() }}</span>
        <span class="stat-label">Cáº£nh bÃ¡o nghiÃªm trá»ng (24h)</span>
      </div>
    </div>
    <div class="stat-card stat-orange">
      <div class="stat-icon">ğŸ›‘</div>
      <div class="stat-info">
        <span class="stat-value">{{ blockedRequests() }}</span>
        <span class="stat-label">YÃªu cáº§u bá»‹ cháº·n</span>
      </div>
    </div>
    <div class="stat-card stat-blue">
      <div class="stat-icon">ğŸŒ</div>
      <div class="stat-info">
        <span class="stat-value">{{ uniqueIps() }}</span>
        <span class="stat-label">IP duy nháº¥t</span>
      </div>
    </div>
    <div class="stat-card stat-purple">
      <div class="stat-icon">ğŸ‘¤</div>
      <div class="stat-info">
        <span class="stat-value">{{ uniqueUsers() }}</span>
        <span class="stat-label">NgÆ°á»i dÃ¹ng liÃªn quan</span>
      </div>
    </div>
  </div>

  <!-- Main Grid -->
  <div class="content-grid">
    <!-- Threats by Type -->
    <div class="card">
      <div class="card-header">
        <h3>âš ï¸ Má»‘i Ä‘e dá»a theo loáº¡i (24h)</h3>
      </div>
      <div class="card-body">
        @if (threatsByType().length > 0) {
          <div class="threat-list">
            @for (threat of threatsByType(); track threat.type) {
              <div class="threat-row">
                <div class="threat-info">
                  <span class="threat-type">{{ formatEventType(threat.type) }}</span>
                  <span class="threat-count">{{ threat.count }}</span>
                </div>
                <div class="threat-bar-bg">
                  <div class="threat-bar" [style.width.%]="getThreatBarWidth(threat)"></div>
                </div>
              </div>
            }
          </div>
        } @else {
          <div class="empty-state">
            <span class="empty-icon">âœ…</span>
            <span>KhÃ´ng phÃ¡t hiá»‡n má»‘i Ä‘e dá»a trong 24h qua</span>
          </div>
        }
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="card">
      <div class="card-header">
        <h3>ğŸ”§ Truy cáº­p nhanh</h3>
      </div>
      <div class="card-body">
        <div class="quick-actions">
          <button class="action-card" (click)="navigateTo('/admin/security-events')">
            <span class="action-icon">ğŸ“‹</span>
            <span class="action-label">Sá»± kiá»‡n báº£o máº­t</span>
            <span class="action-desc">Xem chi tiáº¿t táº¥t cáº£ sá»± kiá»‡n</span>
          </button>
          <button class="action-card" (click)="navigateTo('/admin/security-sessions')">
            <span class="action-icon">ğŸ–¥ï¸</span>
            <span class="action-label">PhiÃªn hoáº¡t Ä‘á»™ng</span>
            <span class="action-desc">Quáº£n lÃ½ phiÃªn ngÆ°á»i dÃ¹ng</span>
          </button>
          <button class="action-card" (click)="navigateTo('/admin/security-threats')">
            <span class="action-icon">ğŸ”</span>
            <span class="action-label">ÄÃ¡nh giÃ¡ má»‘i Ä‘e dá»a</span>
            <span class="action-desc">Kiá»ƒm tra IP vÃ  thiáº¿t bá»‹</span>
          </button>
          <button class="action-card" (click)="navigateTo('/admin/zero-trust')">
            <span class="action-icon">ğŸ”</span>
            <span class="action-label">ChÃ­nh sÃ¡ch Zero Trust</span>
            <span class="action-desc">Cáº¥u hÃ¬nh chÃ­nh sÃ¡ch truy cáº­p</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Recent Events -->
  <div class="card">
    <div class="card-header">
      <h3>ğŸ“Š Sá»± kiá»‡n gáº§n Ä‘Ã¢y</h3>
      <div class="header-actions">
        <button class="btn btn-sm btn-primary" (click)="navigateTo('/admin/security-events')">
          Xem táº¥t cáº£ â†’
        </button>
      </div>
    </div>
    <div class="table-wrapper">
      <table class="data-table">
        <thead>
          <tr>
            <th>Thá»i gian</th>
            <th>Loáº¡i</th>
            <th>Má»©c Ä‘á»™</th>
            <th>NgÆ°á»i dÃ¹ng</th>
            <th>IP</th>
            <th>ÄÆ°á»ng dáº«n</th>
            <th>Tráº¡ng thÃ¡i</th>
          </tr>
        </thead>
        <tbody>
          @for (event of recentEvents(); track event.id) {
            <tr [class.row-blocked]="event.isBlocked">
              <td class="time-cell">{{ formatTimeAgo(event.createdAt) }}</td>
              <td>
                <div class="event-type-cell">
                  <span class="event-icon">{{ getEventIcon(event.eventType) }}</span>
                  <span class="event-type">{{ formatEventType(event.eventType) }}</span>
                </div>
              </td>
              <td>
                <span class="badge" [ngClass]="getSeverityClass(event.severity)">
                  {{ event.severity }}
                </span>
              </td>
              <td>{{ event.username || 'â€”' }}</td>
              <td class="ip-cell">{{ event.ipAddress || 'â€”' }}</td>
              <td class="path-cell">{{ event.requestPath || 'â€”' }}</td>
              <td>
                @if (event.isBlocked) {
                  <span class="badge severity-critical">ğŸ›‘ Bá»‹ cháº·n</span>
                } @else {
                  <span class="badge severity-info">âœ“ Cho phÃ©p</span>
                }
              </td>
            </tr>
          } @empty {
            <tr>
              <td colspan="7" class="empty-state">ChÆ°a cÃ³ sá»± kiá»‡n nÃ o</td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  </div>

  <!-- Loading Overlay -->
  @if (loading()) {
    <div class="loading-indicator">
      <div class="spinner"></div>
    </div>
  }

  <!-- Toast -->
  @if (statusMessage()) {
    <div
      class="toast"
      [class.toast-success]="statusMessage()!.type === 'success'"
      [class.toast-error]="statusMessage()!.type === 'error'"
    >
      {{ statusMessage()!.text }}
    </div>
  }
</div>
