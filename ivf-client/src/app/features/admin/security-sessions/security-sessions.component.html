<div class="security-page">
  <div class="page-header">
    <h2>ğŸ–¥ï¸ Quáº£n lÃ½ phiÃªn hoáº¡t Ä‘á»™ng</h2>
    <p class="subtitle">Theo dÃµi vÃ  quáº£n lÃ½ phiÃªn Ä‘Äƒng nháº­p theo Zero Trust</p>
  </div>

  <!-- Search -->
  <div class="card">
    <div class="card-header">
      <h3>ğŸ” Tra cá»©u phiÃªn</h3>
    </div>
    <div class="card-body">
      <div class="search-form">
        <div class="form-group">
          <label>User ID</label>
          <input
            type="text"
            [(ngModel)]="lookupUserId"
            placeholder="Nháº­p User ID (GUID)..."
            (keydown.enter)="searchSessions()"
          />
        </div>
        <button
          class="btn btn-primary"
          (click)="searchSessions()"
          [disabled]="loading() || !lookupUserId.trim()"
        >
          ğŸ” TÃ¬m phiÃªn
        </button>
      </div>
    </div>
  </div>

  <!-- Session Results -->
  @for (userSession of userSessions(); track userSession.userId) {
    <div class="card session-card">
      <div class="card-header" (click)="toggleExpand(userSession)">
        <div class="user-header">
          <span class="expand-icon">{{ userSession.expanded ? 'â–¼' : 'â–¶' }}</span>
          <h3>ğŸ‘¤ {{ userSession.userId.substring(0, 8) }}...</h3>
          <span class="session-count">{{ userSession.sessions.length }} phiÃªn</span>
        </div>
        <div class="header-actions">
          @if (userSession.sessions.length > 0) {
            <button
              class="btn btn-xs btn-danger"
              (click)="revokeAllSessions(userSession); $event.stopPropagation()"
            >
              ğŸ—‘ï¸ Thu há»“i táº¥t cáº£
            </button>
          }
          <button
            class="btn btn-xs btn-outline"
            (click)="removeUser(userSession.userId); $event.stopPropagation()"
          >
            âœ•
          </button>
        </div>
      </div>

      @if (userSession.expanded) {
        <div class="card-body">
          @if (userSession.sessions.length > 0) {
            <div class="sessions-list">
              @for (session of userSession.sessions; track session.sessionId) {
                <div class="session-item" [class.session-active]="session.isActive">
                  <div class="session-main">
                    <div class="session-info-grid">
                      <div class="info-item">
                        <span class="info-label">Session ID</span>
                        <span class="mono">{{ session.sessionId.substring(0, 16) }}...</span>
                      </div>
                      <div class="info-item">
                        <span class="info-label">IP</span>
                        <span class="mono">{{ session.ipAddress }}</span>
                      </div>
                      <div class="info-item">
                        <span class="info-label">Quá»‘c gia</span>
                        <span>{{ session.country || 'â€”' }}</span>
                      </div>
                      <div class="info-item">
                        <span class="info-label">Táº¡o lÃºc</span>
                        <span>{{ formatDate(session.createdAt) }}</span>
                      </div>
                      <div class="info-item">
                        <span class="info-label">Hoáº¡t Ä‘á»™ng cuá»‘i</span>
                        <span>{{ formatTimeAgo(session.lastActivityAt) }}</span>
                      </div>
                      <div class="info-item">
                        <span class="info-label">Tráº¡ng thÃ¡i</span>
                        <span
                          class="badge"
                          [class.badge-active]="session.isActive"
                          [class.badge-inactive]="!session.isActive"
                        >
                          {{ session.isActive ? 'ğŸŸ¢ Hoáº¡t Ä‘á»™ng' : 'âš« NgÆ°ng' }}
                        </span>
                      </div>
                    </div>
                    @if (session.deviceFingerprint) {
                      <div class="fingerprint-row">
                        <span class="info-label">Device Fingerprint</span>
                        <span class="mono small">{{ session.deviceFingerprint }}</span>
                      </div>
                    }
                  </div>
                  <div class="session-actions">
                    <button
                      class="btn btn-sm btn-danger"
                      (click)="revokeSession(userSession, session)"
                    >
                      ğŸ›‘ Thu há»“i
                    </button>
                  </div>
                </div>
              }
            </div>
          } @else {
            <div class="empty-state">
              <span>KhÃ´ng cÃ³ phiÃªn hoáº¡t Ä‘á»™ng</span>
            </div>
          }
        </div>
      }
    </div>
  }

  @if (userSessions().length === 0) {
    <div class="card">
      <div class="empty-state-large">
        <span class="empty-icon">ğŸ–¥ï¸</span>
        <span class="empty-text">Nháº­p User ID Ä‘á»ƒ xem phiÃªn hoáº¡t Ä‘á»™ng</span>
      </div>
    </div>
  }

  <!-- Toast -->
  @if (statusMessage()) {
    <div
      class="toast"
      [class.toast-success]="statusMessage()!.type === 'success'"
      [class.toast-error]="statusMessage()!.type === 'error'"
    >
      {{ statusMessage()!.text }}
    </div>
  }

  @if (loading()) {
    <div class="loading-indicator"><div class="spinner"></div></div>
  }
</div>
