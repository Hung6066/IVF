<div class="dashboard-layout">
    <header class="page-header">
        <div class="header-title">
            <h1>üìã Nh·∫≠t k√Ω ho·∫°t ƒë·ªông</h1>
        </div>
    </header>

    <!-- Filters -->
    <div class="card filter-card">
        <div class="filter-row">
            <div class="form-group">
                <label>Lo·∫°i entity</label>
                <select [(ngModel)]="filters.entityType" (change)="search()">
                    <option value="">T·∫•t c·∫£</option>
                    <option value="Patient">B·ªánh nh√¢n</option>
                    <option value="Couple">C·∫∑p v·ª£ ch·ªìng</option>
                    <option value="TreatmentCycle">Chu k·ª≥ ƒëi·ªÅu tr·ªã</option>
                    <option value="Appointment">L·ªãch h·∫πn</option>
                    <option value="Invoice">H√≥a ƒë∆°n</option>
                    <option value="User">Ng∆∞·ªùi d√πng</option>
                </select>
            </div>
            <div class="form-group">
                <label>H√†nh ƒë·ªông</label>
                <select [(ngModel)]="filters.action" (change)="search()">
                    <option value="">T·∫•t c·∫£</option>
                    <option value="Create">T·∫°o m·ªõi</option>
                    <option value="Update">C·∫≠p nh·∫≠t</option>
                    <option value="Delete">X√≥a</option>
                </select>
            </div>
            <div class="form-group">
                <label>T·ª´ ng√†y</label>
                <input type="date" [(ngModel)]="fromDate" (change)="search()">
            </div>
            <div class="form-group">
                <label>ƒê·∫øn ng√†y</label>
                <input type="date" [(ngModel)]="toDate" (change)="search()">
            </div>
            <button class="btn-primary" (click)="search()">T√¨m ki·∫øm</button>
        </div>
    </div>

    <!-- Logs Table -->
    <div class="card">
        <div class="section-header">
            <h2>Danh s√°ch nh·∫≠t k√Ω</h2>
        </div>
        <table class="data-table">
            <thead>
                <tr>
                    <th>Th·ªùi gian</th>
                    <th>Ng∆∞·ªùi d√πng</th>
                    <th>H√†nh ƒë·ªông</th>
                    <th>ƒê·ªëi t∆∞·ª£ng</th>
                    <th>Thay ƒë·ªïi</th>
                    <th>IP</th>
                </tr>
            </thead>
            <tbody>
                @for (log of logs(); track log.id) {
                <tr>
                    <td class="time-cell">{{ formatDateTime(log.createdAt) }}</td>
                    <td>{{ log.username || 'System' }}</td>
                    <td>
                        <span class="status-badge" [class]="log.action.toLowerCase()">{{ getActionLabel(log.action)
                            }}</span>
                    </td>
                    <td>
                        <div class="entity-type">{{ log.entityType }}</div>
                        <div class="entity-id">{{ log.entityId.substring(0, 8) }}...</div>
                    </td>
                    <td class="changes-cell">
                        @if (log.changedColumns) {
                        <span class="changed-columns">{{ log.changedColumns }}</span>
                        } @else if (log.action === 'Create') {
                        <span class="new-record">B·∫£n ghi m·ªõi</span>
                        } @else if (log.action === 'Delete') {
                        <span class="deleted-record">ƒê√£ x√≥a</span>
                        }
                    </td>
                    <td class="ip-cell">{{ log.ipAddress || '-' }}</td>
                </tr>
                } @empty {
                <tr>
                    <td colspan="6" class="empty-state">Kh√¥ng c√≥ d·ªØ li·ªáu</td>
                </tr>
                }
            </tbody>
        </table>

        <!-- Pagination -->
        <div class="pagination">
            <button class="btn-secondary" [disabled]="filters.page === 1" (click)="prevPage()">‚Üê Tr∆∞·ªõc</button>
            <span>Trang {{ filters.page }}</span>
            <button class="btn-secondary" [disabled]="logs().length < filters.pageSize!" (click)="nextPage()">Sau
                ‚Üí</button>
        </div>
    </div>
</div>