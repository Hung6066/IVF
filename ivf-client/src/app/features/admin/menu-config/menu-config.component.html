<div class="menu-config">
  <!-- Header -->
  <div class="page-header">
    <div class="header-left">
      <h2>‚öôÔ∏è C·∫•u h√¨nh menu</h2>
      <p class="subtitle">
        Qu·∫£n l√Ω c√°c m·ª•c menu hi·ªÉn th·ªã tr√™n sidebar. Thay ƒë·ªïi s·∫Ω √°p d·ª•ng cho t·∫•t c·∫£ ng∆∞·ªùi d√πng.
      </p>
    </div>
    <button class="btn-primary" (click)="openModal()">+ Th√™m menu</button>
  </div>

  <!-- Loading -->
  @if (loading()) {
    <div class="loading-container">
      <div class="spinner"></div>
      <span>ƒêang t·∫£i...</span>
    </div>
  }

  <!-- Menu Items by Section -->
  @if (!loading()) {
    @for (group of groupedItems; track group.section) {
      <div class="section-card">
        <div class="section-header">
          <h3>{{ group.section }}</h3>
          <span class="item-count">{{ group.items.length }} m·ª•c</span>
        </div>

        <div class="items-table">
          <div class="table-header">
            <span class="col-order">#</span>
            <span class="col-icon">Icon</span>
            <span class="col-label">T√™n hi·ªÉn th·ªã</span>
            <span class="col-route">Route</span>
            <span class="col-permission">Quy·ªÅn</span>
            <span class="col-status">Tr·∫°ng th√°i</span>
            <span class="col-actions">Thao t√°c</span>
          </div>

          @for (item of group.items; track item.id) {
            <div class="table-row" [class.inactive]="!item.isActive">
              <span class="col-order">{{ item.sortOrder }}</span>
              <span class="col-icon">{{ item.icon }}</span>
              <span class="col-label">
                <strong>{{ item.label }}</strong>
                @if (item.adminOnly) {
                  <span class="badge admin-badge">Admin</span>
                }
              </span>
              <span class="col-route">
                <code>{{ item.route }}</code>
              </span>
              <span class="col-permission">
                @if (item.permission) {
                  <span class="badge perm-badge">{{ item.permission }}</span>
                } @else if (item.adminOnly) {
                  <span class="badge admin-badge">Admin only</span>
                } @else {
                  <span class="text-muted">‚Äî</span>
                }
              </span>
              <span class="col-status">
                <button
                  class="toggle-btn"
                  [class.active]="item.isActive"
                  (click)="toggleActive(item)"
                  [title]="item.isActive ? 'ƒêang hi·ªÉn th·ªã' : 'ƒêang ·∫©n'"
                >
                  {{ item.isActive ? '‚úÖ' : '‚ùå' }}
                </button>
              </span>
              <span class="col-actions">
                <button class="btn-icon" title="Di chuy·ªÉn l√™n" (click)="moveUp(item, group.items)">
                  ‚¨ÜÔ∏è
                </button>
                <button
                  class="btn-icon"
                  title="Di chuy·ªÉn xu·ªëng"
                  (click)="moveDown(item, group.items)"
                >
                  ‚¨áÔ∏è
                </button>
                <button class="btn-icon" title="Ch·ªânh s·ª≠a" (click)="openModal(item)">‚úèÔ∏è</button>
                <button class="btn-icon btn-danger" title="Xo√°" (click)="deleteItem(item)">
                  üóëÔ∏è
                </button>
              </span>
            </div>
          }
        </div>
      </div>
    }

    @if (items().length === 0) {
      <div class="empty-state">
        <span class="empty-icon">üìã</span>
        <p>Ch∆∞a c√≥ menu item n√†o. Nh·∫•n "Th√™m menu" ƒë·ªÉ b·∫Øt ƒë·∫ßu.</p>
      </div>
    }
  }
</div>

<!-- Modal -->
@if (showModal) {
  <div class="modal-backdrop" (click)="closeModal()">
    <div class="modal-card" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>{{ editingItem ? '‚úèÔ∏è S·ª≠a menu item' : '‚ûï Th√™m menu item' }}</h3>
        <button class="close-btn" (click)="closeModal()">√ó</button>
      </div>

      <div class="modal-body">
        <div class="form-row">
          <div class="form-group">
            <label>Icon (emoji)</label>
            <input type="text" [(ngModel)]="formData.icon" placeholder="üìä" maxlength="4" />
          </div>
          <div class="form-group flex-2">
            <label>T√™n hi·ªÉn th·ªã *</label>
            <input type="text" [(ngModel)]="formData.label" placeholder="Dashboard" required />
          </div>
        </div>

        <div class="form-group">
          <label>Route *</label>
          <input type="text" [(ngModel)]="formData.route" placeholder="/dashboard" required />
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Section</label>
            <input type="text" [(ngModel)]="formData.section" placeholder="admin" />
            <small>ƒê·ªÉ tr·ªëng = menu ch√≠nh. "admin" = ph·∫ßn qu·∫£n tr·ªã.</small>
          </div>
          <div class="form-group">
            <label>Ti√™u ƒë·ªÅ section</label>
            <input type="text" [(ngModel)]="formData.sectionHeader" placeholder="Qu·∫£n tr·ªã" />
            <small>Ch·ªâ c·∫ßn ƒëi·ªÅn ·ªü item ƒë·∫ßu ti√™n c·ªßa section.</small>
          </div>
        </div>

        <div class="form-group">
          <label>Quy·ªÅn truy c·∫≠p</label>
          <select [(ngModel)]="formData.permission">
            <option value="">-- Kh√¥ng y√™u c·∫ßu --</option>
            @for (p of availablePermissions; track p) {
              <option [value]="p">{{ formatPermission(p) }}</option>
            }
          </select>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Th·ª© t·ª± hi·ªÉn th·ªã</label>
            <input type="number" [(ngModel)]="formData.sortOrder" min="0" />
          </div>
          <div class="form-group checkbox-group">
            <label>
              <input type="checkbox" [(ngModel)]="formData.adminOnly" />
              Ch·ªâ Admin
            </label>
            <label>
              <input type="checkbox" [(ngModel)]="formData.isActive" />
              Hi·ªÉn th·ªã
            </label>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn-ghost" (click)="closeModal()">H·ªßy</button>
        <button
          class="btn-primary"
          [disabled]="saving() || !formData.label || !formData.route"
          (click)="saveItem()"
        >
          {{ saving() ? 'ƒêang l∆∞u...' : 'üíæ L∆∞u' }}
        </button>
      </div>
    </div>
  </div>
}
