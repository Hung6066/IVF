<div class="page-container">
    <header class="page-header">
        <div class="header-content">
            <h1>üìã Danh m·ª•c d·ªãch v·ª•</h1>
            <p class="text-muted">Qu·∫£n l√Ω c√°c d·ªãch v·ª•, gi√° c·∫£ v√† danh m·ª•c</p>
        </div>
        <button class="btn-primary" (click)="openModal()">
            <span class="icon">+</span> Th√™m d·ªãch v·ª•
        </button>
    </header>

    <!-- Filters -->
    <div class="filters-card">
        <div class="filter-group">
            <span class="search-icon">üîç</span>
            <input type="text" [(ngModel)]="search" (keyup.enter)="loadServices()" placeholder="T√¨m ki·∫øm d·ªãch v·ª•..."
                class="search-input">
        </div>

        <select [(ngModel)]="categoryFilter" (change)="loadServices()" class="filter-select">
            <option value="">T·∫•t c·∫£ danh m·ª•c</option>
            <option value="LabTest">X√©t nghi·ªám</option>
            <option value="Ultrasound">Si√™u √¢m</option>
            <option value="Procedure">Th·ªß thu·∫≠t</option>
            <option value="Medication">Thu·ªëc</option>
            <option value="Consultation">T∆∞ v·∫•n</option>
            <option value="IVF">IVF</option>
            <option value="Andrology">Nam khoa</option>
            <option value="SpermBank">Ng√¢n h√†ng tinh tr√πng</option>
            <option value="Other">Kh√°c</option>
        </select>

        <button class="btn-secondary" (click)="loadServices()">√Åp d·ª•ng</button>
    </div>

    <!-- Table -->
    <div class="table-container">
        <table class="premium-table">
            <thead>
                <tr>
                    <th>M√£ DV</th>
                    <th>T√™n d·ªãch v·ª•</th>
                    <th>Danh m·ª•c</th>
                    <th class="text-end">ƒê∆°n gi√°</th>
                    <th class="text-center">Tr·∫°ng th√°i</th>
                    <th class="text-end">Thao t√°c</th>
                </tr>
            </thead>
            <tbody>
                @for (service of services(); track service.id) {
                <tr class="hover-row">
                    <td><span class="code-tag">{{ service.code }}</span></td>
                    <td>
                        <div class="service-name">{{ service.name }}</div>
                        <div class="service-desc" *ngIf="service.description">{{ service.description }}</div>
                    </td>
                    <td>
                        <span class="category-badge">{{ service.category }}</span>
                    </td>
                    <td class="text-end font-weight-bold">{{ formatPrice(service.unitPrice) }}</td>
                    <td class="text-center">
                        <label class="switch">
                            <input type="checkbox" [checked]="service.isActive" (change)="toggleStatus(service)">
                            <span class="slider round"></span>
                        </label>
                    </td>
                    <td class="text-end">
                        <div class="action-buttons">
                            <button class="btn-icon edit" (click)="openModal(service)" title="Ch·ªânh s·ª≠a">
                                ‚úèÔ∏è
                            </button>
                        </div>
                    </td>
                </tr>
                } @empty {
                <tr>
                    <td colspan="6" class="empty-state">
                        <div class="empty-content">
                            <div class="empty-icon">üìã</div>
                            <h3>Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu</h3>
                        </div>
                    </td>
                </tr>
                }
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    <div class="pagination-footer">
        <span class="text-muted">Hi·ªÉn th·ªã {{ services().length }} k·∫øt qu·∫£</span>
        <div class="pagination-buttons">
            <button class="btn-page" [disabled]="page === 1" (click)="changePage(-1)">‚Üê Tr∆∞·ªõc</button>
            <span class="page-number">{{ page }}</span>
            <button class="btn-page" [disabled]="services().length < pageSize" (click)="changePage(1)">Sau ‚Üí</button>
        </div>
    </div>
</div>

<!-- Modal -->
@if (showModal) {
<div class="modal-backdrop" (click)="closeModal()">
    <div class="modal-card" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h2>{{ editingService ? 'C·∫≠p nh·∫≠t d·ªãch v·ª•' : 'Th√™m d·ªãch v·ª• m·ªõi' }}</h2>
            <button class="close-btn" (click)="closeModal()">√ó</button>
        </div>

        <form (ngSubmit)="saveService()" class="modal-body">
            <div class="form-grid">
                <div class="form-group">
                    <label>M√£ d·ªãch v·ª• <span class="required">*</span></label>
                    <input class="modern-input" [(ngModel)]="formData.code" name="code" required
                        placeholder="VD: DV001">
                </div>

                <div class="form-group">
                    <label>Danh m·ª•c <span class="required">*</span></label>
                    <select class="modern-select" [(ngModel)]="formData.category" name="category" required>
                        <option value="LabTest">X√©t nghi·ªám</option>
                        <option value="Ultrasound">Si√™u √¢m</option>
                        <option value="Procedure">Th·ªß thu·∫≠t</option>
                        <option value="Medication">Thu·ªëc</option>
                        <option value="Consultation">T∆∞ v·∫•n</option>
                        <option value="IVF">IVF</option>
                        <option value="Andrology">Nam khoa</option>
                        <option value="SpermBank">Ng√¢n h√†ng tinh tr√πng</option>
                        <option value="Other">Kh√°c</option>
                    </select>
                </div>

                <div class="form-group full-width">
                    <label>T√™n d·ªãch v·ª• <span class="required">*</span></label>
                    <input class="modern-input" [(ngModel)]="formData.name" name="name" required
                        placeholder="Nh·∫≠p t√™n d·ªãch v·ª•">
                </div>

                <div class="form-group">
                    <label>ƒê∆°n gi√° (VNƒê) <span class="required">*</span></label>
                    <input class="modern-input" type="number" [(ngModel)]="formData.unitPrice" name="price" required
                        min="0">
                </div>

                <div class="form-group">
                    <label>ƒê∆°n v·ªã t√≠nh</label>
                    <input class="modern-input" [(ngModel)]="formData.unit" name="unit" placeholder="L·∫ßn, Vi√™n, H·ªôp...">
                </div>

                <div class="form-group full-width">
                    <label>M√¥ t·∫£</label>
                    <textarea class="modern-input" [(ngModel)]="formData.description" name="description"
                        rows="3"></textarea>
                </div>

                <div class="form-group full-width">
                    <label class="checkbox-label">
                        <input type="checkbox" [(ngModel)]="formData.isActive" name="isActive">
                        <span>ƒêang ho·∫°t ƒë·ªông</span>
                    </label>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn-ghost" (click)="closeModal()">H·ªßy b·ªè</button>
                <button type="submit" class="btn-primary" [disabled]="loading()">
                    {{ loading() ? 'ƒêang l∆∞u...' : 'L∆∞u th√¥ng tin' }}
                </button>
            </div>
        </form>
    </div>
</div>
}