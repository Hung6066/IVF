<div class="patient-context-bar">
  @if (selectedPatient) {
    <div class="patient-selected">
      <span class="patient-icon">ğŸ‘¤</span>
      <div class="patient-info">
        <strong>{{ selectedPatient.fullName }}</strong>
        <span class="patient-code">{{ selectedPatient.patientCode }}</span>
      </div>
      @if (linkedData.length > 0) {
        <span class="linked-count" title="Sá»‘ trÆ°á»ng Ä‘Æ°á»£c tá»± Ä‘á»™ng Ä‘iá»n tá»« form khÃ¡c">
          ğŸ”— {{ linkedData.length }} liÃªn káº¿t
        </span>
      }
      <button type="button" class="btn-change-patient" (click)="onClearPatient()">Äá»•i BN</button>
    </div>
  } @else {
    <div class="patient-search">
      <span class="search-icon">ğŸ”</span>
      <input
        type="text"
        class="patient-search-input"
        [value]="patientSearchQuery"
        (input)="onSearchInput($any($event.target).value)"
        (blur)="onHideDropdown()"
        placeholder="TÃ¬m bá»‡nh nhÃ¢n (mÃ£, tÃªn, SÄT)..."
      />
      @if (showPatientDropdown && patientSearchResults.length > 0) {
        <div class="patient-dropdown">
          @for (p of patientSearchResults; track p.id) {
            <div class="patient-option" (mousedown)="onSelectPatient(p)">
              <span class="option-name">{{ p.fullName }}</span>
              <span class="option-code">{{ p.patientCode }}</span>
            </div>
          }
        </div>
      }
    </div>
    <span class="patient-hint">Chá»n bá»‡nh nhÃ¢n Ä‘á»ƒ tá»± Ä‘á»™ng liÃªn káº¿t dá»¯ liá»‡u tá»« cÃ¡c form khÃ¡c</span>
  }
</div>
