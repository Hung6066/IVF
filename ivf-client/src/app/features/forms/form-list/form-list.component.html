<div class="form-list-container">
  <header class="page-header">
    <div class="header-content">
      <h1>ğŸ“ Quáº£n lÃ½ Biá»ƒu máº«u</h1>
      <p class="subtitle">Táº¡o vÃ  quáº£n lÃ½ biá»ƒu máº«u Ä‘á»™ng cho cÃ¡c phÃ²ng ban</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-library" (click)="openLibrary()">
        <span class="icon">ğŸ“š</span>
        ThÆ° viá»‡n máº«u
      </button>
      <button class="btn btn-primary" (click)="createTemplate()">
        <span class="icon">â•</span>
        Táº¡o biá»ƒu máº«u má»›i
      </button>
    </div>
  </header>

  <!-- Categories Section -->
  <section class="categories-section">
    <div class="section-header">
      <h2>Danh má»¥c</h2>
      <button class="btn btn-sm btn-secondary" (click)="showCategoryModal = true">
        ThÃªm danh má»¥c
      </button>
    </div>
    <div class="category-tabs">
      <button
        class="category-tab"
        [class.active]="!selectedCategoryId"
        (click)="selectCategory(null)"
      >
        Táº¥t cáº£
      </button>
      @for (category of categories; track category.id) {
        <button
          class="category-tab"
          [class.active]="selectedCategoryId === category.id"
          (click)="selectCategory(category.id)"
        >
          {{ category.iconName || 'ğŸ“' }} {{ category.name }}
          @if (category.templateCount) {
            <span class="badge">{{ category.templateCount }}</span>
          }
        </button>
      }
    </div>
  </section>

  <!-- Templates Grid -->
  <section class="templates-section">
    <div class="templates-grid">
      @for (template of filteredTemplates; track template.id) {
        <div class="template-card" [class.published]="template.isPublished">
          <div class="template-header">
            <div class="template-status" [class.published]="template.isPublished">
              {{ template.isPublished ? 'âœ… ÄÃ£ xuáº¥t báº£n' : 'ğŸ“ Báº£n nhÃ¡p' }}
            </div>
            <div class="template-menu">
              <button class="menu-btn" (click)="toggleMenu(template.id)">â‹®</button>
              @if (openMenuId === template.id) {
                <div class="dropdown-menu">
                  <button (click)="editTemplate(template.id)">âœï¸ Chá»‰nh sá»­a</button>
                  <button (click)="previewTemplate(template.id)">ğŸ‘ï¸ Xem trÆ°á»›c</button>
                  <button (click)="chatMode(template.id)">ğŸ’¬ Cháº¿ Ä‘á»™ Chat</button>
                  @if (!template.isPublished) {
                    <button (click)="publishTemplate(template.id)">ğŸ“¤ Xuáº¥t báº£n</button>
                  } @else {
                    <button (click)="unpublishTemplate(template.id)">ğŸ“¥ Gá»¡ xuáº¥t báº£n</button>
                  }
                  <button (click)="duplicateTemplate(template.id)">ğŸ“‹ NhÃ¢n báº£n</button>
                  <button class="danger" (click)="deleteTemplate(template.id)">ğŸ—‘ï¸ XÃ³a</button>
                </div>
              }
            </div>
          </div>
          <div class="template-body" (click)="editTemplate(template.id)">
            <h3>{{ template.name }}</h3>
            <p class="description">{{ template.description || 'KhÃ´ng cÃ³ mÃ´ táº£' }}</p>
            <div class="template-meta">
              <span class="category">{{ template.categoryName }}</span>
              <span class="version">v{{ template.version }}</span>
            </div>
          </div>
          <div class="template-footer">
            <span class="field-count"> {{ template.fields?.length || 0 }} trÆ°á»ng </span>
            <span class="created-date">
              {{ template.createdAt | date: 'dd/MM/yyyy' }}
            </span>
          </div>
        </div>
      }

      <!-- Empty State -->
      @if (filteredTemplates.length === 0) {
        <div class="empty-state">
          <div class="empty-icon">ğŸ“„</div>
          <h3>ChÆ°a cÃ³ biá»ƒu máº«u nÃ o</h3>
          <p>Báº¯t Ä‘áº§u báº±ng cÃ¡ch táº¡o má»™t biá»ƒu máº«u má»›i</p>
          <button class="btn btn-primary" (click)="createTemplate()">Táº¡o biá»ƒu máº«u Ä‘áº§u tiÃªn</button>
        </div>
      }
    </div>
  </section>

  <!-- Quick Access -->
  <section class="quick-access">
    <h3>Truy cáº­p nhanh</h3>
    <div class="quick-links">
      <a routerLink="/forms/responses" class="quick-link">
        <span class="icon">ğŸ“Š</span>
        <span>Xem pháº£n há»“i</span>
      </a>
      <a routerLink="/forms/reports" class="quick-link">
        <span class="icon">ğŸ“ˆ</span>
        <span>BÃ¡o cÃ¡o</span>
      </a>
    </div>
  </section>

  <!-- Category Modal -->
  @if (showCategoryModal) {
    <div class="modal-overlay" (click)="showCategoryModal = false">
      <div class="modal" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>ThÃªm danh má»¥c má»›i</h3>
          <button class="close-btn" (click)="showCategoryModal = false">âœ•</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label>TÃªn danh má»¥c *</label>
            <input type="text" [(ngModel)]="newCategory.name" placeholder="VD: PhÃ²ng XÃ©t nghiá»‡m" />
          </div>
          <div class="form-group">
            <label>MÃ´ táº£</label>
            <textarea
              [(ngModel)]="newCategory.description"
              placeholder="MÃ´ táº£ danh má»¥c..."
            ></textarea>
          </div>
          <div class="form-group">
            <label>Icon (emoji)</label>
            <input type="text" [(ngModel)]="newCategory.iconName" placeholder="ğŸ§ª" />
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" (click)="showCategoryModal = false">Há»§y</button>
          <button class="btn btn-primary" (click)="saveCategory()" [disabled]="!newCategory.name">
            LÆ°u danh má»¥c
          </button>
        </div>
      </div>
    </div>
  }

  <!-- Template Library Modal -->
  @if (showLibraryModal) {
    <div class="modal-overlay" (click)="showLibraryModal = false">
      <div class="modal modal-lg" (click)="$event.stopPropagation()">
        <div class="modal-header library-header">
          <h3>ğŸ“š ThÆ° viá»‡n biá»ƒu máº«u IVF</h3>
          <button class="close-btn" (click)="showLibraryModal = false">âœ•</button>
        </div>
        <div class="modal-body library-body">
          <p class="library-subtitle">
            Chá»n máº«u biá»ƒu máº«u sáºµn Ä‘á»ƒ báº¯t Ä‘áº§u nhanh. Máº«u sáº½ Ä‘Æ°á»£c nhÃ¢n báº£n vÃ o danh sÃ¡ch cá»§a báº¡n.
          </p>
          @if (libraryTemplates.length === 0) {
            <div class="library-empty">
              <p>
                ChÆ°a cÃ³ máº«u nÃ o trong thÆ° viá»‡n. ThÆ° viá»‡n sáº½ Ä‘Æ°á»£c táº¡o tá»± Ä‘á»™ng khi khá»Ÿi táº¡o há»‡ thá»‘ng.
              </p>
            </div>
          } @else {
            <div class="library-grid">
              @for (tpl of libraryTemplates; track tpl.id) {
                <div class="library-card">
                  <div class="library-card-body">
                    <h4>{{ tpl.name }}</h4>
                    <p class="library-desc">{{ tpl.description || 'KhÃ´ng cÃ³ mÃ´ táº£' }}</p>
                    <div class="library-meta">
                      <span class="field-count">{{ tpl.fields?.length || 0 }} trÆ°á»ng</span>
                      <span class="version">v{{ tpl.version }}</span>
                    </div>
                  </div>
                  <div class="library-card-footer">
                    <button
                      class="btn btn-use"
                      (click)="useTemplate(tpl.id)"
                      [disabled]="duplicatingId === tpl.id"
                    >
                      @if (duplicatingId === tpl.id) {
                        â³ Äang táº¡o...
                      } @else {
                        ğŸš€ Sá»­ dá»¥ng máº«u
                      }
                    </button>
                  </div>
                </div>
              }
            </div>
          }
        </div>
      </div>
    </div>
  }
</div>
