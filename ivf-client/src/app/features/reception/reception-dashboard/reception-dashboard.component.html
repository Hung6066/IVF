<div class="dashboard-layout">
    <header class="page-header">
        <div class="header-title">
            <h1>ğŸ¥ Tiáº¿p Ä‘Ã³n & Thu ngÃ¢n</h1>
        </div>
        <div class="quick-actions">
            <button class="btn btn-primary" routerLink="/patients/new">â• BN Má»›i</button>
            <button class="btn btn-secondary" routerLink="/couples/new">ğŸ’‘ Táº¡o cáº·p Ä‘Ã´i</button>
        </div>
    </header>

    <div class="search-section card">
        <input type="text" class="search-input" [(ngModel)]="searchTerm"
            placeholder="TÃ¬m bá»‡nh nhÃ¢n (MÃ£ BN, TÃªn, SÄT, CCCD)..." (keyup.enter)="searchPatient()" />
        <button class="btn btn-primary" (click)="searchPatient()">ğŸ” TÃ¬m</button>
    </div>

    @if (searchResults().length > 0) {
    <section class="search-results card">
        <h2>Káº¿t quáº£ tÃ¬m kiáº¿m</h2>
        <div class="result-list">
            @for (patient of searchResults(); track patient.id) {
            <div class="result-card" (click)="selectPatient(patient)">
                <div class="patient-avatar">ğŸ‘¤</div>
                <div class="patient-info">
                    <strong>{{ patient.fullName }}</strong>
                    <span class="code">{{ patient.patientCode }}</span>
                </div>
                <div class="patient-meta">
                    <span>ğŸ“± {{ patient.phone || 'N/A' }}</span>
                    <span>ğŸ‚ {{ formatDate(patient.dateOfBirth) }}</span>
                </div>
                <button class="btn btn-sm btn-success" (click)="$event.stopPropagation(); checkinPatient(patient)">
                    ÄÄƒng kÃ½ khÃ¡m
                </button>
            </div>
            }
        </div>
    </section>
    }

    <div class="dashboard-grid">
        <section class="queue-section card">
            <h2>ğŸ« Sá»‘ Ä‘ang chá» hÃ´m nay</h2>
            <div class="queue-numbers">
                <a routerLink="/queue/TV" class="queue-item consultation">
                    <span class="dept">TÆ° váº¥n</span>
                    <span class="count">{{ queueTuVan() }}</span>
                </a>
                <a routerLink="/queue/US" class="queue-item ultrasound">
                    <span class="dept">SiÃªu Ã¢m</span>
                    <span class="count">{{ queueSieuAm() }}</span>
                </a>
                <a routerLink="/queue/TM" class="queue-item injection">
                    <span class="dept">TiÃªm</span>
                    <span class="count">{{ queueTiem() }}</span>
                </a>
                <a routerLink="/queue/XN" class="queue-item lab">
                    <span class="dept">XÃ©t nghiá»‡m</span>
                    <span class="count">{{ queueXN() }}</span>
                </a>
            </div>
        </section>

        <section class="payment-section card">
            <h2>ğŸ’° Thu ngÃ¢n hÃ´m nay</h2>
            <div class="payment-stats">
                <div class="payment-item">
                    <span class="label">Tá»•ng thu</span>
                    <span class="value">{{ formatCurrency(totalPayment()) }}</span>
                </div>
                <div class="payment-item">
                    <span class="label">Sá»‘ phiáº¿u</span>
                    <span class="value">{{ paymentCount() }}</span>
                </div>
                <div class="payment-item">
                    <span class="label">Chá» thanh toÃ¡n</span>
                    <span class="value pending">{{ pendingPayment() }}</span>
                </div>
            </div>
        </section>

        <section class="recent-checkins card">
            <h2>ğŸ“‹ ÄÄƒng kÃ½ gáº§n Ä‘Ã¢y</h2>
            <div class="checkin-list">
                @for (checkin of recentCheckins(); track checkin.id) {
                <div class="checkin-item">
                    <span class="time">{{ formatTime(checkin.time) }}</span>
                    <span class="name">{{ checkin.patientName }}</span>
                    <span class="dept-tag">{{ checkin.department }}</span>
                </div>
                } @empty {
                <div class="empty-state">ChÆ°a cÃ³ Ä‘Äƒng kÃ½</div>
                }
            </div>
        </section>
    </div>

    @if (showCheckinModal) {
    <div class="modal-overlay" (click)="showCheckinModal = false">
        <div class="modal-content" (click)="$event.stopPropagation()">
            <h3>ğŸ“ ÄÄƒng kÃ½ khÃ¡m: {{ selectedPatient?.fullName }}</h3>
            <form (ngSubmit)="submitCheckin()">
                <div class="form-group">
                    <label class="form-label">Dá»‹ch vá»¥ / PhÃ²ng khÃ¡m *</label>
                    <select class="form-control" [(ngModel)]="checkinData.department" name="dept" required>
                        <option value="TV">TÆ° váº¥n (TV)</option>
                        <option value="US">SiÃªu Ã¢m (US)</option>
                        <option value="TM">TiÃªm (TM)</option>
                        <option value="XN">XÃ©t nghiá»‡m (XN)</option>
                        <option value="NAM">Nam khoa</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">BÃ¡c sÄ© chá»‰ Ä‘á»‹nh (tÃ¹y chá»n)</label>
                    <input class="form-control" type="text" [(ngModel)]="checkinData.doctor" name="doctor"
                        placeholder="VD: BS. Giang" />
                </div>
                <div class="form-group">
                    <label class="form-label">Má»©c Ä‘á»™ Æ°u tiÃªn</label>
                    <select class="form-control" [(ngModel)]="checkinData.priority" name="priority">
                        <option value="Normal">BÃ¬nh thÆ°á»ng</option>
                        <option value="High">Æ¯u tiÃªn</option>
                        <option value="VIP">VIP</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Ghi chÃº</label>
                    <textarea class="form-control" [(ngModel)]="checkinData.notes" name="notes"
                        placeholder="LÃ½ do khÃ¡m..."></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" (click)="showCheckinModal = false">Huá»·</button>
                    <button type="submit" class="btn btn-primary">Cáº¥p sá»‘ & In phiáº¿u</button>
                </div>
            </form>
        </div>
    </div>
    }
</div>