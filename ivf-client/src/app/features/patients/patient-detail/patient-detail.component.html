<div class="patient-detail">
    <header class="page-header">
        <a routerLink="/patients" class="back-link">
            <span>‚Üê</span> Danh s√°ch b·ªánh nh√¢n
        </a>
        <div class="patient-header">
            <div class="avatar">{{ getInitials(patient()?.fullName) }}</div>
            <div class="header-info">
                <h1>{{ patient()?.fullName }}</h1>
                <div class="meta-badges">
                    <span class="code-tag">{{ patient()?.patientCode }}</span>
                    <span class="badge gender" [class.male]="patient()?.gender === 'Male'"
                        [class.female]="patient()?.gender === 'Female'">
                        {{ patient()?.gender === 'Female' ? 'N·ªØ' : 'Nam' }}
                    </span>
                    <span class="badge type">{{ getTypeName(patient()?.patientType) }}</span>
                </div>
            </div>
        </div>
    </header>

    <div class="content-grid">
        <!-- Basic Info Card -->
        <section class="card info-card">
            <h2 class="card-title">Th√¥ng tin c∆° b·∫£n</h2>
            <div class="info-grid">
                <div class="info-item">
                    <label>Ng√†y sinh</label>
                    <span class="info-value">{{ formatDate(patient()?.dateOfBirth) }}</span>
                </div>
                <div class="info-item">
                    <label>ƒêi·ªán tho·∫°i</label>
                    <span class="info-value">{{ patient()?.phone || '‚Äî' }}</span>
                </div>
                <div class="info-item">
                    <label>ƒê·ªãa ch·ªâ</label>
                    <span class="info-value">{{ patient()?.address || '‚Äî' }}</span>
                </div>
                <div class="info-item">
                    <label>CCCD/CMND</label>
                    <span class="info-value">{{ patient()?.identityNumber || '‚Äî' }}</span>
                </div>
            </div>
        </section>

        <!-- Quick Actions -->
        <section class="card actions-card">
            <h2 class="card-title">Thao t√°c nhanh</h2>
            <div class="action-grid">
                <a [routerLink]="['/patients', patientId, 'biometrics']" class="action-item biometrics">
                    <span class="action-icon">üì∑</span>
                    <div class="action-info">
                        <span class="action-title">Sinh tr·∫Øc h·ªçc</span>
                        <span class="action-desc">·∫¢nh ch√¢n dung & v√¢n tay</span>
                    </div>
                    <span class="action-arrow">‚Üí</span>
                </a>
            </div>
        </section>

        <!-- Forms Section -->
        @if (formTemplates().length > 0) {
        <section class="card forms-card">
            <div class="section-header">
                <h2 class="card-title">üìã Bi·ªÉu m·∫´u</h2>
            </div>
            <p class="forms-hint">ƒêi·ªÅn form cho b·ªánh nh√¢n ‚Äî d·ªØ li·ªáu s·∫Ω t·ª± ƒë·ªông li√™n k·∫øt gi·ªØa c√°c form c√πng concept</p>
            <div class="form-template-list">
                @for (tmpl of formTemplates(); track tmpl.id) {
                <a [routerLink]="['/forms/fill', tmpl.id]" [queryParams]="{ patientId: patientId }" class="form-template-item">
                    <div class="form-template-info">
                        <span class="form-template-name">{{ tmpl.name }}</span>
                        @if (tmpl.description) {
                        <span class="form-template-desc">{{ tmpl.description }}</span>
                        }
                    </div>
                    <span class="action-arrow">‚Üí</span>
                </a>
                }
            </div>
        </section>
        }

        <!-- Partner Info (if exists) -->
        @if (couple()) {
        <section class="card info-card partner">
            <h2 class="card-title">Th√¥ng tin c·∫∑p ƒë√¥i</h2>
            <div class="couple-display">
                <div class="partner-box wife">
                    <span class="role-label">V·ª£</span>
                    <span class="partner-name">{{ couple()?.wife?.fullName }}</span>
                </div>
                <div class="heart-connector">‚ù§Ô∏è</div>
                <div class="partner-box husband">
                    <span class="role-label">Ch·ªìng</span>
                    <span class="partner-name">{{ couple()?.husband?.fullName }}</span>
                </div>
            </div>
            <div class="couple-meta-info">
                <div class="meta-item">
                    <span class="icon">üíç</span>
                    <span>Ng√†y c∆∞·ªõi: {{ formatDate(couple()?.marriageDate) || '‚Äî' }}</span>
                </div>
                <div class="meta-item">
                    <span class="icon">‚è≥</span>
                    <span>Hi·∫øm mu·ªôn: <strong>{{ couple()?.infertilityYears || '?' }}</strong> nƒÉm</span>
                </div>
            </div>
        </section>
        }

        <!-- Treatment Cycles -->
        <section class="card cycles-card">
            <div class="section-header">
                <h2 class="card-title">Chu k·ª≥ ƒëi·ªÅu tr·ªã ({{ cycles().length }})</h2>
                <button class="btn btn-primary btn-sm" (click)="createNewCycle()">‚ûï T·∫°o chu k·ª≥ m·ªõi</button>
            </div>

            <div class="cycle-list">
                @for (cycle of cycles(); track cycle.id) {
                <a [routerLink]="['/cycles', cycle.id]" class="cycle-item">
                    <div class="cycle-code-badge">{{ cycle.cycleCode }}</div>

                    <div class="cycle-details">
                        <span class="cycle-method">{{ getMethodName(cycle.method) }}</span>
                        <span class="cycle-phase">{{ getPhaseName(cycle.currentPhase) }}</span>
                    </div>

                    <div class="cycle-status">
                        <span class="date">{{ formatDate(cycle.startDate) }}</span>
                        <span class="status-badge" [class]="(cycle.outcome || '').toLowerCase()">
                            {{ getOutcomeName(cycle.outcome) }}
                        </span>
                    </div>
                </a>
                } @empty {
                <div class="empty-state">
                    <span class="empty-icon">üçÉ</span>
                    <p>Ch∆∞a c√≥ chu k·ª≥ ƒëi·ªÅu tr·ªã n√†o</p>
                </div>
                }
            </div>
        </section>
    </div>
</div>