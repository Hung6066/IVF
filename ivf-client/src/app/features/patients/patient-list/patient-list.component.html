<div class="patient-list-container">
    <header class="page-header">
        <div class="header-content">
            <h1>Danh s√°ch b·ªánh nh√¢n</h1>
            <p>Qu·∫£n l√Ω th√¥ng tin b·ªánh nh√¢n</p>
        </div>
        <button class="btn btn-primary" (click)="showAddModal = true">‚ûï Th√™m b·ªánh nh√¢n</button>
    </header>

    <div class="search-bar">
        <input type="text" class="form-control" [(ngModel)]="searchQuery" (input)="onSearch()"
            placeholder="üîç T√¨m ki·∫øm theo t√™n, m√£ b·ªánh nh√¢n, SƒêT..." />
    </div>

    <div class="card table-container">
        <table class="data-table">
            <thead>
                <tr>
                    <th>M√£ BN</th>
                    <th>H·ªç t√™n</th>
                    <th>Ng√†y sinh</th>
                    <th>Gi·ªõi t√≠nh</th>
                    <th>SƒêT</th>
                    <th>Lo·∫°i BN</th>
                    <th class="text-right">Thao t√°c</th>
                </tr>
            </thead>
            <tbody>
                @for (patient of patients(); track patient.id) {
                <tr>
                    <td><span class="code-badge">{{ patient.patientCode }}</span></td>
                    <td class="font-medium">{{ patient.fullName }}</td>
                    <td>{{ formatDate(patient.dateOfBirth) }}</td>
                    <td>
                        <span class="gender-badge" [class.male]="patient.gender === 'Male'"
                            [class.female]="patient.gender === 'Female'">
                            {{ patient.gender === 'Male' ? 'Nam' : 'N·ªØ' }}
                        </span>
                    </td>
                    <td>{{ patient.phone || '-' }}</td>
                    <td>{{ getPatientType(patient.patientType) }}</td>
                    <td class="actions-cell">
                        <button class="btn-icon" title="Xem" (click)="viewPatient(patient)">üëÅÔ∏è</button>
                        <button class="btn-icon" title="S·ª≠a" (click)="editPatient(patient)">‚úèÔ∏è</button>
                    </td>
                </tr>
                } @empty {
                <tr>
                    <td colspan="7" class="empty-state">
                        {{ loading() ? 'ƒêang t·∫£i...' : 'Kh√¥ng c√≥ d·ªØ li·ªáu' }}
                    </td>
                </tr>
                }
            </tbody>
        </table>
    </div>

    <div class="pagination">
        <span>T·ªïng: {{ total() }} b·ªánh nh√¢n</span>
        <div class="page-controls">
            <button class="btn btn-sm btn-secondary" [disabled]="page() <= 1" (click)="changePage(page() - 1)">‚Üê
                Tr∆∞·ªõc</button>
            <span class="page-info">Trang {{ page() }}</span>
            <button class="btn btn-sm btn-secondary" [disabled]="patients().length < pageSize"
                (click)="changePage(page() + 1)">Sau ‚Üí</button>
        </div>
    </div>

    @if (showAddModal) {
    <div class="modal-overlay" (click)="showAddModal = false">
        <div class="modal-content" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <h2>‚ûï Th√™m b·ªánh nh√¢n m·ªõi</h2>
                <button class="close-btn" (click)="showAddModal = false">√ó</button>
            </div>

            <form (ngSubmit)="submitNewPatient()">
                <div class="modal-body">
                    <div class="form-grid">
                        <div class="form-group full-width">
                            <label>H·ªç v√† t√™n *</label>
                            <input class="form-control" type="text" [(ngModel)]="newPatient.fullName" name="fullName"
                                required placeholder="Nh·∫≠p h·ªç t√™n ƒë·∫ßy ƒë·ªß" />
                        </div>

                        <div class="form-group">
                            <label>Ng√†y sinh</label>
                            <input class="form-control" type="date" [(ngModel)]="newPatient.dateOfBirth" name="dob" />
                        </div>

                        <div class="form-group">
                            <label>Gi·ªõi t√≠nh</label>
                            <select class="form-control" [(ngModel)]="newPatient.gender" name="gender">
                                <option value="Female">N·ªØ</option>
                                <option value="Male">Nam</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>SƒêT</label>
                            <input class="form-control" type="tel" [(ngModel)]="newPatient.phone" name="phone"
                                placeholder="09xxxx" />
                        </div>

                        <div class="form-group">
                            <label>CMND/CCCD</label>
                            <input class="form-control" type="text" [(ngModel)]="newPatient.idNumber" name="idNumber" />
                        </div>

                        <div class="form-group full-width">
                            <label>Lo·∫°i b·ªánh nh√¢n</label>
                            <select class="form-control" [(ngModel)]="newPatient.patientType" name="patientType">
                                <option value="Infertility">Hi·∫øm mu·ªôn</option>
                                <option value="EggDonor">Cho tr·ª©ng</option>
                                <option value="SpermDonor">Cho tinh</option>
                            </select>
                        </div>

                        <div class="form-group full-width">
                            <label>ƒê·ªãa ch·ªâ</label>
                            <input class="form-control" type="text" [(ngModel)]="newPatient.address" name="address"
                                placeholder="ƒê·ªãa ch·ªâ li√™n h·ªá" />
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn-secondary" (click)="showAddModal = false">Hu·ª∑</button>
                    <button type="submit" class="btn-primary">L∆∞u h·ªì s∆°</button>
                </div>
            </form>
        </div>
    </div>
    }

    @if (showEditModal) {
    <div class="modal-overlay" (click)="showEditModal = false">
        <div class="modal-content" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <h2>‚úèÔ∏è Ch·ªânh s·ª≠a b·ªánh nh√¢n</h2>
                <button class="close-btn" (click)="showEditModal = false">√ó</button>
            </div>

            <form (ngSubmit)="submitEditPatient()">
                <div class="modal-body">
                    <div class="form-grid">
                        <div class="form-group full-width">
                            <label>M√£ b·ªánh nh√¢n</label>
                            <input class="form-control" type="text" [value]="editingPatient?.patientCode" disabled />
                        </div>

                        <div class="form-group full-width">
                            <label>H·ªç v√† t√™n *</label>
                            <input class="form-control" type="text" [(ngModel)]="editingPatient.fullName"
                                name="fullName" required placeholder="Nh·∫≠p h·ªç t√™n ƒë·∫ßy ƒë·ªß" />
                        </div>

                        <div class="form-group">
                            <label>Ng√†y sinh</label>
                            <input class="form-control" type="date" [(ngModel)]="editingPatient.dateOfBirth"
                                name="dob" />
                        </div>

                        <div class="form-group">
                            <label>Gi·ªõi t√≠nh</label>
                            <select class="form-control" [(ngModel)]="editingPatient.gender" name="gender">
                                <option value="Female">N·ªØ</option>
                                <option value="Male">Nam</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>SƒêT</label>
                            <input class="form-control" type="tel" [(ngModel)]="editingPatient.phone" name="phone"
                                placeholder="09xxxx" />
                        </div>

                        <div class="form-group">
                            <label>CMND/CCCD</label>
                            <input class="form-control" type="text" [(ngModel)]="editingPatient.idNumber"
                                name="idNumber" />
                        </div>

                        <div class="form-group full-width">
                            <label>Lo·∫°i b·ªánh nh√¢n</label>
                            <select class="form-control" [(ngModel)]="editingPatient.patientType" name="patientType">
                                <option value="Infertility">Hi·∫øm mu·ªôn</option>
                                <option value="EggDonor">Cho tr·ª©ng</option>
                                <option value="SpermDonor">Cho tinh</option>
                            </select>
                        </div>

                        <div class="form-group full-width">
                            <label>ƒê·ªãa ch·ªâ</label>
                            <input class="form-control" type="text" [(ngModel)]="editingPatient.address" name="address"
                                placeholder="ƒê·ªãa ch·ªâ li√™n h·ªá" />
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn-secondary" (click)="showEditModal = false">Hu·ª∑</button>
                    <button type="submit" class="btn-primary">C·∫≠p nh·∫≠t</button>
                </div>
            </form>
        </div>
    </div>
    }
</div>