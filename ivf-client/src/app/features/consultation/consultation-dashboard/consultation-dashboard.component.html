<div class="dashboard-layout">
    <header class="page-header">
        <div class="header-title">
            <h1>üó£Ô∏è Ph√≤ng T∆∞ v·∫•n</h1>
        </div>
        <div class="header-actions">
            <!-- Actions if needed -->
        </div>
    </header>

    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon info">‚è≥</div>
            <div class="stat-content">
                <span class="value">{{ queueCount() }}</span>
                <span class="label">ƒêang ch·ªù</span>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon success">‚úÖ</div>
            <div class="stat-content">
                <span class="value">{{ completedCount() }}</span>
                <span class="label">ƒê√£ t∆∞ v·∫•n</span>
            </div>
        </div>
    </div>

    <div class="tabs-container">
        <button class="tab-btn" [class.active]="activeTab === 'queue'" (click)="activeTab = 'queue'">H√†ng ƒë·ª£i</button>
        <button class="tab-btn" [class.active]="activeTab === 'history'" (click)="activeTab = 'history'">L·ªãch
            s·ª≠</button>
    </div>

    @if (activeTab === 'queue') {
    <section class="card">
        <div class="section-header">
            <h2>Danh s√°ch ch·ªù ({{ queueCount() }})</h2>
        </div>
        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>STT</th>
                        <th>H·ªç t√™n</th>
                        <th>M√£ BN</th>
                        <th>Gi·ªù l·∫•y s·ªë</th>
                        <th>Tr·∫°ng th√°i</th>
                        <th class="text-right">Thao t√°c</th>
                    </tr>
                </thead>
                <tbody>
                    @for (q of queue(); track q.id) {
                    <tr>
                        <td class="stt-cell">{{ q.ticketNumber }}</td>
                        <td>{{ q.patientName }}</td>
                        <!-- <td><span class="code-cell">{{ q.patientId }}</span></td> -->
                        <td>{{ formatTime(q.issuedAt) }}</td>
                        <td>
                            @if (q.status === 'Waiting') { <span class="status-badge pending">ƒêang ch·ªù</span> }
                            @else if (q.status === 'Called') { <span class="status-badge called">ƒêang g·ªçi</span> }
                            @else if (q.status === 'InService') { <span class="status-badge processing">ƒêang t∆∞
                                v·∫•n</span> }
                            @else { <span class="status-badge">{{ q.status }}</span> }
                        </td>
                        <td class="actions-cell">
                            <button class="btn btn-sm btn-primary" (click)="callPatient(q)">üì¢ G·ªçi</button>
                            <button class="btn btn-sm btn-success" (click)="startConsult(q)">üë®‚Äç‚öïÔ∏è T∆∞ v·∫•n</button>
                        </td>
                    </tr>
                    } @empty {
                    <tr>
                        <td colspan="6" class="empty-state">Kh√¥ng c√≥ b·ªánh nh√¢n ch·ªù</td>
                    </tr>
                    }
                </tbody>
            </table>
        </div>
    </section>
    }

    @if (activeTab === 'history') {
    <section class="card">
        <div class="empty-state">T√≠nh nƒÉng l·ªãch s·ª≠ ƒëang ph√°t tri·ªÉn</div>
    </section>
    }

    @if (showForm) {
    <div class="modal-overlay" (click)="showForm = false">
        <div class="modal-content" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <h3>üìù Ghi nh·∫≠n t∆∞ v·∫•n</h3>
                <button class="close-btn" (click)="showForm = false">&times;</button>
            </div>

            <form (ngSubmit)="submitConsult()">
                <div class="modal-body">
                    <div class="patient-info-summary">
                        <strong>BN: </strong> {{ currentPatientName }}
                    </div>

                    <div class="form-group">
                        <label class="form-label">Ghi ch√∫ t∆∞ v·∫•n</label>
                        <textarea class="form-control" [(ngModel)]="consultNotes" name="notes" rows="5"
                            placeholder="N·ªôi dung t∆∞ v·∫•n..."></textarea>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" (click)="showForm = false">Hu·ª∑</button>
                    <button type="submit" class="btn btn-primary">Ho√†n th√†nh & L∆∞u</button>
                </div>
            </form>
        </div>
    </div>
    }
</div>